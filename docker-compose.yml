services:
  airfi:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: airfi-backend
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - GIN_MODE=release
      - DB_PATH=/app/data/airfi.db
      - KEYS_DIR=/app/keys
      - HOST_PRIVATE_KEY=${HOST_PRIVATE_KEY:-}
      - DASHBOARD_PASSWORD=${DASHBOARD_PASSWORD:-airfi2025}
    volumes:
      # Persist database
      - airfi-data:/app/data
      # Persist JWT keys
      - airfi-keys:/app/keys
      # Optional: mount custom config
      # - ./config/config.yaml:/app/config/config.yaml:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s

volumes:
  airfi-data:
  airfi-keys:
